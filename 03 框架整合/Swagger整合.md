# 分布式缓存实现方法

目前常见的缓存方案都是分层缓存，通常可以分为以下几层：

- `NG` 本地缓存，命中的话直接返回。
- `NG` 没有命中时则需要查询分布式缓存，如 `Redis` 。
- 如果分布式缓存没有命中则需要回源到 `Tomcat` 在本地堆进行查询，命中之后异步写回 `Redis` 。
- 以上都没有命中那就只有从 `DB` 或者是数据源进行查询，并写回到 Redis 中



写缓存时也要注意，通常来说分为以下几步：

- 开启事务。
- 写入 DB 。
- 提交事务。
- 写入缓存。

这里可能会存在数据库写入成功但是缓存写入失败的情况，但是也不建议将写入缓存加入到事务中。 因为写缓存的时候可能会因为网络原因耗时较长，这样会阻塞数据库事务。 如果对一致性要求不高并且数据量也不大的情况下，可以单独起一个服务来做 DB 和缓存之间的数据同步操作。

更新缓存时也建议做增量更新。
